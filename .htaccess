# Relax Media System .htaccess
# Minimal version to avoid 403 errors

# Enable CORS for API calls
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type, X-Requested-With"
</IfModule>

# Cache video files for better performance
<FilesMatch "\.(mp4|webm|ogg|mov)$">
    Header set Cache-Control "public, max-age=604800, immutable"
    Header set Accept-Ranges "bytes"
</FilesMatch>

<IfModule mod_headers.c>
  # Cache video files for a week; allow seeking
  <FilesMatch "\.(mp4|webm|ogg|mov)$">
    Header set Cache-Control "public, max-age=604800, immutable"
    Header set Accept-Ranges "bytes"
  </FilesMatch>

  # Prevent caching of dynamic endpoints
  <FilesMatch "^(api|video|thumb)\.php$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>
</IfModule>

# Allow large file uploads/streams (if PHP via FPM respects .htaccess)
php_value memory_limit 512M
php_value max_execution_time 0

# Prevent caching of API responses
<FilesMatch "api\.php$">
    <IfModule mod_headers.c>
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </IfModule>
</FilesMatch>

# Basic security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options nosniff
    Header set X-Frame-Options SAMEORIGIN
</IfModule>
